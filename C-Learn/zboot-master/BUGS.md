# BUGS

- 在STM32F401上, 固件尺寸超过128K时写入FLASH会出错. (感谢wufeng.jiang指出) 

- 在STM32F103RC上, 执行sysinfo命令显示的RAM尺寸在Makefile里指定的64K而不是实际的48K.

- 在部分大容量器件上执行擦除时间较长, 需要把iap.py里EraseImage之后的time.sleep(0.5)这里改为1.0或1.5, 否则写入的app会不正确.

# TODOLIST

- 硬件CRC32校验: STM32大部分都有硬件CRC单元(我不确定是否全系都有), 但是操作方式不完全相同. 因此使用硬件CRC32校验的话还需要针对不同型号仔细适配. 此外, 如果需要校验的内容较多, 还需要用DMA来加速. 

- flash_eeprom优化: 目前用的是伪地址方案, 每次写入时按"地址:数据"成对写入, 读取时从后往前查找, 找到第一个匹配的地址即返回. 写入时则是从前往后查找, 找到第一个空地址后写入并返回. 将来这里需要改成二分查找, 能稍微快一点.

    - ST官方文档的做法, 写满时是用另一页FLASH作为后备页来轮转, 这样使用SRAM空间较少, 并且不怕掉电. 我这里简单起见, 直接在SRAM中轮转, 如果轮转时正好掉电有可能丢失EEPROM全部数据. 在bootloader里问题不大, app里如果追求可靠性的话应该采用ST官方方案, 或者用大电容+掉电中断来预防.
